<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>關鍵職位畫像</title>
<style>
    body { font-family: "Noto Sans TC", sans-serif; padding: 2rem; line-height: 1.6; }
    h1, h2, h3 { margin-top: 1.5rem; }
    .section { margin-top: 1.5rem; }
    .score-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    .score-table th, .score-table td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      vertical-align: top;
    }
    .meta { font-size: 0.9rem; color: #666; }
  </style>
</head>
<body>
<h1>📌 關鍵崗位畫像</h1>
<p class="meta">匯出時間：<span id="timestamp"></span></p>
<div id="roleContent"></div>
<script>
  // 顯示匯出時間
  document.getElementById("timestamp").textContent = new Date().toLocaleString("zh-TW");

  const index = new URLSearchParams(window.location.search).get("index");
  const roles = JSON.parse(localStorage.getItem("roles") || "[]");
  const role = roles[index];

  if (!role) {
    document.getElementById("roleContent").innerHTML = "<p>查無職位資料。</p>";
  } else {
    const content = document.getElementById("roleContent");

    const sectionHTML = (title, items) => `
      <h3>${title}</h3>
      ${items.map(item => `
        <div class="section">
          <strong>${item.title}</strong>
          <p>${item.desc}</p>
          <table class="score-table">
            <thead><tr><th>分數</th><th>描述</th></tr></thead>
            <tbody>
              ${item.scores.map(s => {
                const [score, desc] = s.split("分：");
                return `<tr><td>${score}分</td><td>${desc}</td></tr>`;
              }).join("")}
            </tbody>
          </table>
        </div>
      `).join("")}
    `;

    content.innerHTML = `
      <h2>📌 職位名稱：${role.role}</h2>
      <p>${role.description}</p>

      <h3>🎯 硬指標</h3>
      ${["edu", "exp", "skill"].map(key => `
        <div class="section">
          <strong>${key === "edu" ? "學歷" : key === "exp" ? "經歷" : "專業技能"}</strong>
          <p>${role.hard[key].desc}</p>
          <table class="score-table">
            <thead><tr><th>分數</th><th>描述</th></tr></thead>
            <tbody>
              ${role.hard[key].scores.map(s => {
                const [score, desc] = s.split("分：");
                return `<tr><td>${score}分</td><td>${desc}</td></tr>`;
              }).join("")}
            </tbody>
          </table>
        </div>
      `).join("")}

      ${sectionHTML("🌟 軟實力", role.soft)}
      ${sectionHTML("💡 人格特質", role.trait)}
      ${sectionHTML("⚠️ 應避免特質", role.avoid)}
    `;
  }
</script>
<!-- 匯出 PDF 按鈕 -->
<button onclick="window.print()" style="margin-top: 2rem; padding: 0.5rem 1rem;">📥 匯出職位畫像 PDF</button>
<!-- 📥 匯出 PDF 按鈕 -->
<button onclick="exportPDF()" style="margin-top: 2rem; padding: 0.5rem 1rem;">📥 匯出職位畫像 PDF</button>
<!-- 載入 html2pdf.js 套件 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  function exportPDF() {
    const titleElement = document.querySelector("h2");
    const roleName = titleElement ? titleElement.innerText.replace("📌 職位名稱：", "").trim() : "未命名職位";
    const filename = `職位畫像_${roleName}.pdf`;

    const element = document.body; // 匯出整頁
    const opt = {
      margin: 0.5,
      filename: filename,
      image: { type: "jpeg", quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
    };

    html2pdf().set(opt).from(element).save();
  }
</script>
<hr/>
<p style="text-align: center; font-size: 12px; color: gray;">
  🚀 本頁版本：v20250507 ｜ Generated on 2025/05/07
</p>
</body>
</html>
<hr/>
<p style="text-align: center; font-size: 12px; color: gray;">
  🚀 本頁版本：v20250507 ｜ Generated on 2025/05/07
</p>


