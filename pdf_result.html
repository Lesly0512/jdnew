<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è©•åˆ†çµæœï½œå€‹äººå ±å‘Š</title>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const index = new URLSearchParams(window.location.search).get("feedback");
const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
const fb = feedbacks[index];

if (!fb) {
  document.getElementById("basicInfo").innerHTML = "<p>æ‰¾ä¸åˆ°è©•åˆ†è³‡æ–™ã€‚</p>";
} else {
  // basic info
  document.getElementById("basicInfo").innerHTML = `
      <p>ğŸ‘¤ è¢«è©•äººï¼š${fb.name}</p>
      <p>ğŸ“Œ è·ä½åç¨±ï¼š${fb.role}</p>
      <p>ğŸ•’ æäº¤æ™‚é–“ï¼š${new Date(fb.submittedAt).toLocaleString("zh-TW")}</p>
  `;

  // fit summary
  let total = parseFloat(fb.scoreTotal);
  let level = fb.scoreLevel;
  let explanation = fb.scoreExplanation;

  // fallback if explanation undefined
  if (!explanation) {
    if (total >= 4.5) explanation = "å®Œå…¨ç¬¦åˆè·ä½æ¢ä»¶ï¼Œå…·å‚™å…¨é¢å‹ä»»æ½›åŠ›ã€‚";
    else if (total >= 3.5) explanation = "å¤§éƒ¨åˆ†ç¬¦åˆè·ä½è¦æ±‚ï¼Œå…·å‚™å‹ä»»åŸºç¤ä¸”æ½›åŠ›è‰¯å¥½ã€‚";
    else if (total >= 2.5) explanation = "éƒ¨åˆ†ç¬¦åˆç¡¬æŒ‡æ¨™ï¼ŒæŸäº›è»Ÿå¯¦åŠ›éœ€åŸ¹é¤Šï¼Œèƒ½å‹ä»»ä½†éœ€æ™‚é–“é©æ‡‰èˆ‡å­¸ç¿’ã€‚";
    else if (total >= 1.5) explanation = "èˆ‡éœ€æ±‚æœ‰è½å·®ï¼Œéœ€å¤§é‡åŸ¹è¨“èˆ‡æŒ‡å°æ‰èƒ½å‹‰å¼·å‹ä»»ã€‚";
    else explanation = "èƒŒæ™¯èˆ‡èƒ½åŠ›çš†ä¸ç¬¦ï¼Œé›£ä»¥å‹ä»»è©²è·ä½ï¼ŒåŸ¹é¤Šæˆæœ¬éé«˜ã€‚";
  }

  document.getElementById("fitSummary").innerHTML = `
      <h3>ğŸ” é©é…åº¦åˆ†æ</h3>
      <p><strong>ç¸½åˆ†ï¼š</strong>${total.toFixed(2)} / 5</p>
      <p><strong>åŒ¹é…ç¨‹åº¦ï¼š</strong>${level}</p>
      <p>${explanation}</p>
  `;

  // dynamic radar chart
  const role = JSON.parse(localStorage.getItem("roles") || "[]").find(r => r.role === fb.role);
  const labels = [
    "å­¸æ­·",
    "ç¶“æ­·",
    "æŠ€èƒ½",
    ...role.soft.map(s => s.title),
    ...role.trait.map(t => t.title)
  ];
  const data = fb.scores;

  const ctx = document.getElementById("radarChart").getContext("2d");
  new Chart(ctx, {
    type: "radar",
    data: {
      labels: labels,
      datasets: [{
        label: "å¾—åˆ†",
        data: data,
        fill: true,
        borderColor: "rgba(54, 162, 235, 1)",
        backgroundColor: "rgba(54, 162, 235, 0.2)",
        pointBackgroundColor: "rgba(54, 162, 235, 1)"
      }]
    },
    options: {
      scales: {
        r: { suggestedMin: 0, suggestedMax: 5, ticks: { stepSize: 1 } }
      }
    }
  });
}
</script>

</body>
</html>