<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>è©•åˆ†çµæœï½œå€‹äººå ±å‘Š</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: "Noto Sans TC", sans-serif; padding: 2rem; line-height: 1.6; }
    h2 { margin-bottom: 1rem; }
    .summary { margin-top: 2rem; padding: 1rem; background: #f9f9f9; border: 1px solid #ccc; }
    canvas { max-width: 500px; margin-top: 1rem; }
  </style>
</head>
<body>
<h2>ğŸ“Š è©•åˆ†çµæœå ±å‘Š</h2>
<div id="basicInfo"></div>
<div>
<canvas id="radarChart"></canvas>
</div>
<div class="summary" id="fitSummary">
<p id="match-score"></p>
<p id="match-level"></p>
<p id="match-description"></p>
</div>
<button onclick="window.print()" style="margin-top: 2rem; padding: 0.5rem 1rem;">ğŸ“¥ åŒ¯å‡ºå ±å‘Š</button>
<script>
  const index = new URLSearchParams(window.location.search).get("feedback");
  const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
  const fb = feedbacks[index];

  if (!fb) {
    document.getElementById("basicInfo").innerHTML = "<p>æ‰¾ä¸åˆ°è©•åˆ†è³‡æ–™ã€‚</p>";
  } else {
    document.getElementById("basicInfo").innerHTML = `
      <p>ğŸ‘¤ è¢«è©•äººï¼š${fb.name}</p>
      <p>ğŸ“Œ è·ä½åç¨±ï¼š${fb.role}</p>
      <p>ğŸ•’ æäº¤æ™‚é–“ï¼š${new Date(fb.submittedAt).toLocaleString("zh-TW")}</p>
    `;

    const total = parseFloat(fb.scoreTotal);
    let level = fb.scoreLevel;
    let explanation = fb.scoreExplanation;

    document.getElementById("fitSummary").innerHTML = `
      <h3>ğŸ” é©é…åº¦åˆ†æ</h3>
      <p><strong>ç¸½åˆ†ï¼š</strong>${total.toFixed(2)} åˆ†</p>
      <p><strong>åŒ¹é…ç¨‹åº¦ï¼š</strong>${level}</p>
      <p>${explanation}</p>
    `;

    // è¨­å®šé›·é”åœ–è³‡æ–™
    const totalLen = fb.scores.length;
    const countHard = 3;
    const role = JSON.parse(localStorage.getItem("roles"))?.find(r => r.role === fb.role);
    const countSoft = role?.soft?.length || 0;
    const countTrait = role?.trait?.length || 0;

    const avg = (arr) => arr.reduce((a, b) => a + b, 0) / arr.length;
    const hardAvg = avg(fb.scores.slice(0, 3));
    const softAvg = avg(fb.scores.slice(3, 3 + countSoft));
    const traitAvg = avg(fb.scores.slice(3 + countSoft, 3 + countSoft + countTrait));

    new Chart(document.getElementById("radarChart"), {
      type: "radar",
      data: {
        labels: ["ç¡¬æŒ‡æ¨™", "è»Ÿå¯¦åŠ›", "äººæ ¼ç‰¹è³ª"],
        datasets: [{
          label: "å¹³å‡åˆ†æ•¸",
          data: [hardAvg, softAvg, traitAvg],
          fill: true,
          borderColor: "rgba(54, 162, 235, 1)",
          backgroundColor: "rgba(54, 162, 235, 0.2)",
          pointBackgroundColor: "rgba(54, 162, 235, 1)",
          pointBorderColor: "#fff",
          pointHoverBackgroundColor: "#fff",
          pointHoverBorderColor: "rgba(54, 162, 235, 1)",
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
        },
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 5,
            ticks: {
              stepSize: 1,
              backdropColor: "transparent"
            },
            grid: {
              color: "#ccc"
            },
            pointLabels: {
              font: { size: 14 }
            }
          }
        }
      }
    });
  }
</script>
<hr/><p style="text-align: center; font-size: 12px; color: gray;">ğŸš€ æœ¬é ç‰ˆæœ¬ï¼šv20250507 ï½œ Generated on 2025/05/07</p><script>
document.addEventListener("DOMContentLoaded", function () {
  const score = parseFloat(localStorage.getItem("finalScore")) || 0;
  let matchLevel = "";
  let matchDescription = "";

  if (score >= 4.5) {
    matchLevel = "é«˜åº¦åŒ¹é…";
    matchDescription = "å®Œå…¨ç¬¦åˆè·ä½æ¢ä»¶ï¼Œå…·å‚™å…¨é¢å‹ä»»æ½›åŠ›ã€‚";
  } else if (score >= 3.5) {
    matchLevel = "è‰¯å¥½åŒ¹é…";
    matchDescription = "å¤šæ•¸æ¢ä»¶ç¬¦åˆï¼Œå¯å‹ä»»å¤šæ•¸è·è²¬ï¼Œæ½›åŠ›ä½³ã€‚";
  } else if (score >= 2.5) {
    matchLevel = "éƒ¨åˆ†åŒ¹é…";
    matchDescription = "éƒ¨åˆ†æ¢ä»¶å°šå¯ï¼Œä½†éœ€è£œè¶³éƒ¨åˆ†èƒ½åŠ›èˆ‡ç¶“é©—ã€‚";
  } else if (score >= 1.5) {
    matchLevel = "ä½åº¦åŒ¹é…";
    matchDescription = "å¤šæ•¸æ¢ä»¶ä¸ç¬¦ï¼Œå»ºè­°é€²è¡ŒåŸ¹è¨“æˆ–èª¿æ•´é…ç½®ã€‚";
  } else {
    matchLevel = "å®Œå…¨ä¸åŒ¹é…";
    matchDescription = "ç¼ºä¹é—œéµæ¢ä»¶ï¼Œå»ºè­°é‡æ–°è©•ä¼°è·ä½é©é…æ€§ã€‚";
  }

  document.getElementById("match-score").textContent = "ç¸½åˆ†ï¼š" + score.toFixed(2);
  document.getElementById("match-level").textContent = "åŒ¹é…ç¨‹åº¦ï¼š" + matchLevel;
  document.getElementById("match-description").textContent = matchDescription;
});
</script></body>
</html>
