<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è©•åˆ†çµæœï½œå€‹äººå ±å‘Š</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; padding: 2rem; line-height: 1.6; }
    h2 { margin-bottom: 1rem; }
    .summary { margin-top: 2rem; padding: 1rem; background: #f9f9f9; border: 1px solid #ccc; }
    canvas { max-width: 500px; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>ğŸ“Š è©•åˆ†çµæœå ±å‘Š</h2>
  <div id="basicInfo"></div>
  <div>
    <canvas id="radarChart"></canvas>
  </div>
  <div id="fitSummary" class="summary"></div>

<button onclick="window.print()" style="margin-top: 2rem; padding: 0.5rem 1rem;">ğŸ“¥ åŒ¯å‡ºå ±å‘Š</button>

<script>
  const index = new URLSearchParams(window.location.search).get("feedback");
  const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
  const fb = feedbacks[index];

  if (!fb) {
    document.getElementById("basicInfo").innerHTML = "<p>æ‰¾ä¸åˆ°è©•åˆ†è³‡æ–™ã€‚</p>";
  } else {
    document.getElementById("basicInfo").innerHTML = `
      <p>ğŸ‘¤ è¢«è©•äººï¼š${fb.name}</p>
      <p>ğŸ“Œ è·ä½åç¨±ï¼š${fb.role}</p>
      <p>ğŸ•’ æäº¤æ™‚é–“ï¼š${new Date(fb.submittedAt).toLocaleString("zh-TW")}</p>
    `;

    const total = parseFloat(fb.scoreTotal);
    let level = fb.scoreLevel;
    let explanation = fb.scoreExplanation;

    document.getElementById("fitSummary").innerHTML = `
      <h3>ğŸ” é©é…åº¦åˆ†æ</h3>
      <p><strong>ç¸½åˆ†ï¼š</strong>${total.toFixed(2)} åˆ†</p>
      <p><strong>åŒ¹é…ç¨‹åº¦ï¼š</strong>${level}</p>
      <p>${explanation}</p>
    `;

    // è¨­å®šé›·é”åœ–è³‡æ–™
    const totalLen = fb.scores.length;
    const countHard = 3;
    const role = JSON.parse(localStorage.getItem("roles"))?.find(r => r.role === fb.role);
    const countSoft = role?.soft?.length || 0;
    const countTrait = role?.trait?.length || 0;

    const avg = (arr) => arr.reduce((a, b) => a + b, 0) / arr.length;
    const hardAvg = avg(fb.scores.slice(0, 3));
    const softAvg = avg(fb.scores.slice(3, 3 + countSoft));
    const traitAvg = avg(fb.scores.slice(3 + countSoft, 3 + countSoft + countTrait));

    new Chart(document.getElementById("radarChart"), {
      type: "radar",
      data: {
        labels: ["ç¡¬æŒ‡æ¨™", "è»Ÿå¯¦åŠ›", "äººæ ¼ç‰¹è³ª"],
        datasets: [{
          label: "å¹³å‡åˆ†æ•¸",
          data: [hardAvg, softAvg, traitAvg],
          fill: true,
          borderColor: "rgba(54, 162, 235, 1)",
          backgroundColor: "rgba(54, 162, 235, 0.2)",
          pointBackgroundColor: "rgba(54, 162, 235, 1)",
          pointBorderColor: "#fff",
          pointHoverBackgroundColor: "#fff",
          pointHoverBorderColor: "rgba(54, 162, 235, 1)",
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
        },
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 5,
            ticks: {
              stepSize: 1,
              backdropColor: "transparent"
            },
            grid: {
              color: "#ccc"
            },
            pointLabels: {
              font: { size: 14 }
            }
          }
        }
      }
    });
  }
</script>
</body>
</html>
