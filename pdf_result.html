<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>評分結果｜個人報告</title>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const index = new URLSearchParams(window.location.search).get("feedback");
const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
const fb = feedbacks[index];

if (!fb) {
  document.getElementById("basicInfo").innerHTML = "<p>找不到評分資料。</p>";
} else {
  // basic info
  document.getElementById("basicInfo").innerHTML = `
      <p>👤 被評人：${fb.name}</p>
      <p>📌 職位名稱：${fb.role}</p>
      <p>🕒 提交時間：${new Date(fb.submittedAt).toLocaleString("zh-TW")}</p>
  `;

  // fit summary
  let total = parseFloat(fb.scoreTotal);
  let level = fb.scoreLevel;
  let explanation = fb.scoreExplanation;

  // fallback if explanation undefined
  if (!explanation) {
    if (total >= 4.5) explanation = "完全符合職位條件，具備全面勝任潛力。";
    else if (total >= 3.5) explanation = "大部分符合職位要求，具備勝任基礎且潛力良好。";
    else if (total >= 2.5) explanation = "部分符合硬指標，某些軟實力需培養，能勝任但需時間適應與學習。";
    else if (total >= 1.5) explanation = "與需求有落差，需大量培訓與指導才能勉強勝任。";
    else explanation = "背景與能力皆不符，難以勝任該職位，培養成本過高。";
  }

  document.getElementById("fitSummary").innerHTML = `
      <h3>🔎 適配度分析</h3>
      <p><strong>總分：</strong>${total.toFixed(2)} / 5</p>
      <p><strong>匹配程度：</strong>${level}</p>
      <p>${explanation}</p>
  `;

  // dynamic radar chart
  const role = JSON.parse(localStorage.getItem("roles") || "[]").find(r => r.role === fb.role);
  const labels = [
    "學歷",
    "經歷",
    "技能",
    ...role.soft.map(s => s.title),
    ...role.trait.map(t => t.title)
  ];
  const data = fb.scores;

  const ctx = document.getElementById("radarChart").getContext("2d");
  new Chart(ctx, {
    type: "radar",
    data: {
      labels: labels,
      datasets: [{
        label: "得分",
        data: data,
        fill: true,
        borderColor: "rgba(54, 162, 235, 1)",
        backgroundColor: "rgba(54, 162, 235, 0.2)",
        pointBackgroundColor: "rgba(54, 162, 235, 1)"
      }]
    },
    options: {
      scales: {
        r: { suggestedMin: 0, suggestedMax: 5, ticks: { stepSize: 1 } }
      }
    }
  });
}
</script>

</body>
</html>