<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¾Œå°ç™»å…¥ï½œé—œéµå´—ä½ç•«åƒç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; line-height: 1.6; }
    h2 { margin-top: 2rem; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    textarea, input[type="text"] { width: 100%; padding: 0.5rem; margin-top: 0.2rem; }
    button { margin-top: 0.5rem; padding: 0.4rem 0.8rem; }
    fieldset { border: 1px solid #ccc; padding: 1rem; margin-top: 1rem; position: relative; }
    legend { font-weight: bold; }
    .block { margin-bottom: 1rem; }
    .small-note { font-size: 0.9em; color: #666; margin-top: 0.2rem; }
    .delete-btn { position: absolute; top: 5px; right: 10px; color: red; cursor: pointer; background: none; border: none; }
    .section-block { border: 1px solid #ccc; padding: 1rem; margin-top: 2rem; background: #fafafa; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .role-list { border-top: 1px dashed #ccc; margin-top: 2rem; padding-top: 1rem; }
    .role-item { margin: 0.5rem 0; }
    .json-buttons { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    .feedback-section { border-top: 2px solid #666; margin-top: 3rem; padding-top: 1rem; }
    .feedback-section table { font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>ğŸ” å¾Œå°ç™»å…¥</h1>
  <input type="password" id="passwordInput" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" />
  <button onclick="checkPassword()">ç™»å…¥</button>

  <div id="adminContent" style="display:none;">
    <h2>ğŸ¯ é—œéµè·ä½è¨­å®šè¡¨å–®</h2>
    <form id="roleForm">
      <label>è·ä½åç¨±</label>
      <input type="text" id="roleName" required />
      <label>å·¥ä½œèªªæ˜æ›¸</label>
      <textarea id="jobDescription" rows="3"></textarea>

      <h3>ğŸ“Œ ç¡¬æŒ‡æ¨™</h3>
      <fieldset>
        <legend>å­¸æ­·</legend>
        <label>æè¿°</label>
        <textarea id="eduDesc" required></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="eduScores" rows="5" required></textarea>
        <div class="small-note">è«‹è¼¸å…¥ <strong>äº”è¡Œ</strong>ï¼Œä¸€è¡Œä»£è¡¨ä¸€å€‹åˆ†æ•¸ç­‰ç´šï¼ˆ5ï½1 åˆ†ï¼‰</div>
      </fieldset>

      <fieldset>
        <legend>ç¶“æ­·</legend>
        <label>æè¿°</label>
        <textarea id="expDesc" required></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="expScores" rows="5" required></textarea>
        <div class="small-note">è«‹è¼¸å…¥ <strong>äº”è¡Œ</strong>ï¼Œä¸€è¡Œä»£è¡¨ä¸€å€‹åˆ†æ•¸ç­‰ç´šï¼ˆ5ï½1 åˆ†ï¼‰</div>
      </fieldset>

      <fieldset>
        <legend>å°ˆæ¥­æŠ€èƒ½</legend>
        <label>æè¿°</label>
        <textarea id="skillDesc" required></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="skillScores" rows="5" required></textarea>
        <div class="small-note">è«‹è¼¸å…¥ <strong>äº”è¡Œ</strong>ï¼Œä¸€è¡Œä»£è¡¨ä¸€å€‹åˆ†æ•¸ç­‰ç´šï¼ˆ5ï½1 åˆ†ï¼‰</div>
      </fieldset>

      <h3>ğŸŒŸ è»Ÿå¯¦åŠ›ï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="softContainer"></div>
      <button type="button" onclick="addSection('soft')">ï¼‹æ–°å¢è»Ÿå¯¦åŠ›é …ç›®</button>

      <h3>ğŸ’¡ äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="traitContainer"></div>
      <button type="button" onclick="addSection('trait')">ï¼‹æ–°å¢äººæ ¼ç‰¹è³ªé …ç›®</button>

      <h3>âš ï¸ æ‡‰é¿å…çš„äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šä¸‰é …ï¼‰</h3>
      <div id="avoidContainer"></div>
      <button type="button" onclick="addSection('avoid')">ï¼‹æ–°å¢æ‡‰é¿å…é …ç›®</button>

      <br/><br/>
      <button type="submit">ğŸ“¥ æ–°å¢è·ä½ç•«åƒ</button>
      <button type="button" onclick="clearForm()" style="margin-left:1rem;color:red;">ğŸ—‘ï¸ æ¸…é™¤ç›®å‰è¡¨å–®</button>
    </form>

    <div class="role-list">
      <div class="json-buttons">
        <h3 style="margin: 0;">ğŸ—‚ï¸ å·²æ–°å¢è·ä½æ¸…å–®</h3>
        <input type="file" id="jsonImport" accept=".json" style="display:none" onchange="handleImport(this.files[0])">
        <button onclick="document.getElementById('jsonImport').click()">ğŸ“¥ åŒ¯å…¥ JSON</button>
        <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
      </div>
      <ul id="roleList"></ul>
    </div>

    <div id="displayArea" style="margin-top:2rem;"></div>

    <div class="feedback-section">
      <h2>ğŸ“Š å‰å°è©•åˆ†ç´€éŒ„</h2>
      <div class="json-buttons">
        <input type="file" id="fbImport" accept=".json" style="display:none" onchange="importFeedback(this.files[0])">
        <button onclick="document.getElementById('fbImport').click()">ğŸ“¥ åŒ¯å…¥å›é¥‹</button>
        <button onclick="exportFeedback()">ğŸ“¤ åŒ¯å‡ºå›é¥‹</button>
      </div>
      <div id="feedbackTable"></div>
    </div>
<script>
  const correctPassword = "demo_admin";
  let roles = [];

  function checkPassword() {
    if (document.getElementById("passwordInput").value === correctPassword) {
      document.getElementById("adminContent").style.display = "block";
      const stored = localStorage.getItem("roles");
      roles = stored ? JSON.parse(stored) : [];
      updateRoleList();
      showFeedback();
    } else {
      alert("å¯†ç¢¼éŒ¯èª¤ï¼");
    }
  }

  function updateRoleList() {
    const list = document.getElementById("roleList");
    list.innerHTML = "";
    roles.forEach((r, i) => {
      const li = document.createElement("li");
      li.classList.add("role-item");
      li.innerHTML = `
        ğŸ”˜ <button onclick="displayRole(${i})">${r.role}</button>
        <button onclick="window.open('pdf.html?index=${i}', '_blank')">ğŸ“„ é è¦½èˆ‡åŒ¯å‡º</button>
        <button onclick="deleteRole(${i})" style="color:red;">ğŸ—‘ï¸ åˆªé™¤</button>
      `;
      list.appendChild(li);
    });
    localStorage.setItem("roles", JSON.stringify(roles));
  }

  function deleteRole(index) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è·ä½ï¼Ÿ")) {
      roles.splice(index, 1);
      updateRoleList();
      document.getElementById("displayArea").innerHTML = "";
    }
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(roles, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "roles_backup.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function handleImport(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const data = JSON.parse(e.target.result);
        if (!Array.isArray(data)) throw new Error("æ ¼å¼éŒ¯èª¤ï¼");
        roles = data;
        updateRoleList();
        alert("âœ… è·ä½åŒ¯å…¥æˆåŠŸï¼");
      } catch (err) {
        alert("âŒ åŒ¯å…¥å¤±æ•—ï¼š" + err.message);
      }
    };
    reader.readAsText(file);
  }
  function exportFeedback() {
    const data = localStorage.getItem("feedbacks");
    if (!data) return alert("å°šç„¡ä»»ä½•å›é¥‹è³‡æ–™ï¼");
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "feedbacks_backup.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function importFeedback(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const data = JSON.parse(e.target.result);
        if (!Array.isArray(data)) throw new Error("æ ¼å¼éŒ¯èª¤ï¼");
        localStorage.setItem("feedbacks", JSON.stringify(data));
        showFeedback();
        alert("âœ… å›é¥‹è³‡æ–™åŒ¯å…¥æˆåŠŸï¼");
      } catch (err) {
        alert("âŒ åŒ¯å…¥å¤±æ•—ï¼š" + err.message);
      }
    };
    reader.readAsText(file);
  }

  function showFeedback() {
    const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
    if (feedbacks.length === 0) {
      document.getElementById("feedbackTable").innerHTML = "<p>å°šç„¡å‰å°ä½¿ç”¨è€…è©•åˆ†è³‡æ–™ã€‚</p>";
      return;
    }

    let html = `
      <table>
        <thead>
          <tr>
            <th>#</th><th>å§“å</th><th>è·ä½</th><th>æäº¤æ™‚é–“</th>
            <th>åˆ†æ•¸</th><th>ç¸½åˆ†</th><th>ç­‰ç´š</th><th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          ${feedbacks.map((fb, i) => `
            <tr>
              <td>${i + 1}</td>
              <td>${fb.name}</td>
              <td>${fb.role}</td>
              <td>${new Date(fb.submittedAt).toLocaleString("zh-TW")}</td>
              <td>${fb.scores.join(", ")}</td>
              <td>${parseFloat(fb.scoreTotal || 0).toFixed(2)}</td>
              <td>${fb.scoreLevel || "-"}</td>
              <td>
                <a href="pdf_result.html?feedback=${i}" target="_blank">ğŸ“„</a>
                <button onclick="deleteFeedback(${i})" style="color:red;">ğŸ—‘ï¸</button>
              </td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
    document.getElementById("feedbackTable").innerHTML = html;
  }

  function deleteFeedback(index) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ç­†è©•åˆ†ç´€éŒ„ï¼Ÿ")) {
      const feedbacks = JSON.parse(localStorage.getItem("feedbacks") || "[]");
      feedbacks.splice(index, 1);
      localStorage.setItem("feedbacks", JSON.stringify(feedbacks));
      showFeedback();
    }
  }

  function addSection(type) {
    const containerId = {
      soft: "softContainer",
      trait: "traitContainer",
      avoid: "avoidContainer"
    }[type];

    const max = type === "avoid" ? 3 : 5;
    const container = document.getElementById(containerId);
    if (container.children.length >= max) return alert(`æœ€å¤šåªèƒ½æ–°å¢ ${max} é …ï¼`);

    const index = container.children.length + 1;
    const wrapper = document.createElement("fieldset");
    wrapper.innerHTML = `
      <legend>${type === "soft" ? "è»Ÿå¯¦åŠ›" : type === "trait" ? "äººæ ¼ç‰¹è³ª" : "æ‡‰é¿å…ç‰¹è³ª"} #${index}</legend>
      <label>é …ç›®åç¨±</label>
      <input type="text" />
      <label>æè¿°</label>
      <textarea rows="2"></textarea>
      <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
      <textarea rows="5"></textarea>
      <div class="small-note">è«‹è¼¸å…¥äº”è¡Œï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ5ï½1åˆ†ã€æ¨™ç¤º</div>
      <button type="button" class="delete-btn" onclick="this.parentNode.remove()">âœ–</button>
    `;
    container.appendChild(wrapper);
  }

  function clearForm() {
    document.getElementById("roleForm").reset();
    document.getElementById("softContainer").innerHTML = "";
    document.getElementById("traitContainer").innerHTML = "";
    document.getElementById("avoidContainer").innerHTML = "";
  }

  function displayRole(index) {
    const r = roles[index];
    let html = `<h3>ğŸ“Œ è·ä½ï¼š${r.role}</h3><p>${r.description}</p>`;

    html += `<h4>ğŸ¯ ç¡¬æŒ‡æ¨™</h4><ul>`;
    ["edu", "exp", "skill"].forEach(key => {
      html += `<li><b>${key.toUpperCase()}ï¼š</b>${r.hard[key].desc}<br/>${r.hard[key].scores.join("<br/>")}</li>`;
    });
    html += `</ul>`;

    html += `<h4>ğŸŒŸ è»Ÿå¯¦åŠ›</h4><ul>` + r.soft.map(s =>
      `<li><b>${s.title}</b>ï¼š${s.desc}<br/>${s.scores.join("<br/>")}</li>`
    ).join("") + `</ul>`;

    html += `<h4>ğŸ’¡ äººæ ¼ç‰¹è³ª</h4><ul>` + r.trait.map(s =>
      `<li><b>${s.title}</b>ï¼š${s.desc}<br/>${s.scores.join("<br/>")}</li>`
    ).join("") + `</ul>`;

    html += `<h4>âš ï¸ æ‡‰é¿å…ç‰¹è³ª</h4><ul>` + r.avoid.map(s =>
      `<li><b>${s.title}</b>ï¼š${s.desc}<br/>${s.scores.join("<br/>")}</li>`
    ).join("") + `</ul>`;

    document.getElementById("displayArea").innerHTML = html;
  }

  document.getElementById("roleForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const role = document.getElementById("roleName").value.trim();
    const description = document.getElementById("jobDescription").value.trim();

    const getBlock = (idDesc, idScores) => {
      const scoreLines = document.getElementById(idScores).value.trim().split("\n");
      if (scoreLines.length !== 5) {
        alert("æ¯ä¸€é …è©•åˆ†æè¿°è«‹å¡«å¯«äº”è¡Œï¼");
        throw new Error("æ ¼å¼éŒ¯èª¤");
      }
      return {
        desc: document.getElementById(idDesc).value.trim(),
        scores: scoreLines.map((s, i) => `${5 - i} åˆ†ï¼š${s.trim()}`)
      };
    };

    const hard = {
      edu: getBlock("eduDesc", "eduScores"),
      exp: getBlock("expDesc", "expScores"),
      skill: getBlock("skillDesc", "skillScores")
    };

    const getCustomBlock = (containerId) => {
      return Array.from(document.getElementById(containerId).children).map(f => {
        const scoreLines = f.querySelectorAll("textarea")[1].value.trim().split("\n");
        if (scoreLines.length !== 5) {
          alert("æ¯ä¸€é …è©•åˆ†æè¿°è«‹å¡«å¯«äº”è¡Œï¼");
          throw new Error("æ ¼å¼éŒ¯èª¤");
        }
        return {
          title: f.querySelector("input").value.trim(),
          desc: f.querySelector("textarea").value.trim(),
          scores: scoreLines.map((s, i) => `${5 - i} åˆ†ï¼š${s.trim()}`)
        };
      });
    };

    const soft = getCustomBlock("softContainer");
    const trait = getCustomBlock("traitContainer");
    const avoid = getCustomBlock("avoidContainer");

    roles.push({ role, description, hard, soft, trait, avoid });
    localStorage.setItem("roles", JSON.stringify(roles));
    updateRoleList();
    alert("âœ… è·ä½ç•«åƒå·²æ–°å¢ï¼");
    clearForm();
  });
</script>
</body>
</html>
